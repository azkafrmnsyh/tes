<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Animated Carousel with Stack Effect
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <style>
   /* Container for carousel */
  .carousel {
    perspective: 1000px;
    width: 320px;
    max-width: 90vw;
    margin: auto;
    position: relative;
    height: 320px;
  }

  /* Stack container to hold images */
  .stack {
    position: relative;
    width: 320px;
    height: 320px;
    max-width: 90vw;
    margin: auto;
  }

  /* Each image style */
  .stack img {
    position: absolute;
    width: 320px;
    height: 320px;
    max-width: 90vw;
    border: 4px solid white;
    box-shadow: 0 10px 15px rgba(0,0,0,0.3);
    border-radius: 8px;
    object-fit: cover;
    cursor: pointer;
    user-select: none;
    transition: transform 0.6s ease, box-shadow 0.6s ease;
    will-change: transform;
  }

  /* Different rotation and offset for stacked images */
  .stack img:nth-child(1) {
    top: 0;
    left: 0;
    z-index: 5;
    transform: rotate(0deg) translate(0,0);
  }
  .stack img:nth-child(2) {
    top: 8px;
    left: 8px;
    z-index: 4;
    transform: rotate(-8deg);
  }
  .stack img:nth-child(3) {
    top: 16px;
    left: 16px;
    z-index: 3;
    transform: rotate(8deg);
  }
  .stack img:nth-child(4) {
    top: 24px;
    left: 24px;
    z-index: 2;
    transform: rotate(-5deg);
  }
  .stack img:nth-child(5) {
    top: 32px;
    left: 32px;
    z-index: 1;
    transform: rotate(5deg);
  }

  /* Active top image style */
  .stack img.top {
    z-index: 10 !important;
    box-shadow: 0 20px 30px rgba(0,0,0,0.5);
  }

  /* Animation for desktop: slide left or right then move down and fade out */
  @keyframes slideLeftDown {
    0% {
      transform: translateX(0) translateY(0) rotate(0deg);
      opacity: 1;
      z-index: 10;
    }
    50% {
      transform: translateX(-350px) translateY(0) rotate(-20deg);
      opacity: 1;
      z-index: 10;
    }
    100% {
      transform: translateX(-350px) translateY(350px) rotate(-20deg);
      opacity: 0;
      z-index: 0;
    }
  }
  @keyframes slideRightDown {
    0% {
      transform: translateX(0) translateY(0) rotate(0deg);
      opacity: 1;
      z-index: 10;
    }
    50% {
      transform: translateX(350px) translateY(0) rotate(20deg);
      opacity: 1;
      z-index: 10;
    }
    100% {
      transform: translateX(350px) translateY(350px) rotate(20deg);
      opacity: 0;
      z-index: 0;
    }
  }

  /* Animation for mobile swipe: slide left or right then move down and fade out */
  @keyframes swipeLeftDown {
    0% {
      transform: translateX(0) translateY(0) rotate(0deg);
      opacity: 1;
      z-index: 10;
    }
    50% {
      transform: translateX(-150vw) translateY(0) rotate(-20deg);
      opacity: 1;
      z-index: 10;
    }
    100% {
      transform: translateX(-150vw) translateY(150vw) rotate(-20deg);
      opacity: 0;
      z-index: 0;
    }
  }
  @keyframes swipeRightDown {
    0% {
      transform: translateX(0) translateY(0) rotate(0deg);
      opacity: 1;
      z-index: 10;
    }
    50% {
      transform: translateX(150vw) translateY(0) rotate(20deg);
      opacity: 1;
      z-index: 10;
    }
    100% {
      transform: translateX(150vw) translateY(150vw) rotate(20deg);
      opacity: 0;
      z-index: 0;
    }
  }

  /* Classes to trigger animations */
  .slide-left {
    animation: slideLeftDown 0.8s forwards;
  }
  .slide-right {
    animation: slideRightDown 0.8s forwards;
  }
  .swipe-left {
    animation: swipeLeftDown 0.8s forwards;
  }
  .swipe-right {
    animation: swipeRightDown 0.8s forwards;
  }

  /* Hide overflow so images moving out don't cause scroll */
  body, html {
    overflow-x: hidden;
  }
  </style>
 </head>
 <body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div aria-label="Image carousel with stack animation" class="carousel" id="carousel">
   <div class="stack" id="stack">
    <img alt="Image 1: Mountain landscape with blue sky" class="top" draggable="false" height="320" src="https://storage.googleapis.com/a1aa/image/bbfa4b4e-feec-47d8-a862-026464f7b6ff.jpg" width="320"/>
    <img alt="Image 2: Forest with tall trees and sunlight" draggable="false" height="320" src="https://storage.googleapis.com/a1aa/image/5a134403-92ab-44e5-52fb-51997d437d0e.jpg" width="320"/>
    <img alt="Image 3: Beach with waves and sunset" draggable="false" height="320" src="https://storage.googleapis.com/a1aa/image/f6b7c1bb-c632-4678-81e0-087065e7893c.jpg" width="320"/>
    <img alt="Image 4: City skyline at night with lights" draggable="false" height="320" src="https://storage.googleapis.com/a1aa/image/9315a454-5656-414c-4084-cce392c29ba7.jpg" width="320"/>
    <img alt="Image 5: Desert with sand dunes and blue sky" draggable="false" height="320" src="https://storage.googleapis.com/a1aa/image/acb0d21e-0210-4dfc-a507-5581b80c17e8.jpg" width="320"/>
   </div>
  </div>
  <script>
   (() => {
    const stack = document.getElementById('stack');
    let images = Array.from(stack.querySelectorAll('img'));
    let isAnimating = false;

    // Detect if mobile
    const isMobile = window.matchMedia("(max-width: 768px)").matches;

    // Touch variables for swipe
    let startX = 0;
    let currentX = 0;
    let isTouching = false;

    // Function to reorder images array and update DOM & classes
    function reorderImages(direction) {
      if (direction === 'left') {
        // Move first image to last
        const first = images.shift();
        images.push(first);
      } else if (direction === 'right') {
        // Move last image to first
        const last = images.pop();
        images.unshift(last);
      }
      // Clear stack and re-append images in new order
      stack.innerHTML = '';
      images.forEach((img, i) => {
        img.classList.remove('top', 'slide-left', 'slide-right', 'swipe-left', 'swipe-right');
        // Reset inline styles
        img.style.animation = '';
        img.style.zIndex = 5 - i;
        stack.appendChild(img);
      });
      // Set new top image
      images[0].classList.add('top');
      images[0].style.zIndex = 10;
    }

    // Animate top image sliding left or right then reorder
    function animateSlide(direction) {
      if (isAnimating) return;
      isAnimating = true;
      const topImg = images[0];
      // Add animation class
      if (isMobile) {
        topImg.classList.add(direction === 'left' ? 'swipe-left' : 'swipe-right');
      } else {
        topImg.classList.add(direction === 'left' ? 'slide-left' : 'slide-right');
      }
      // After animation ends, reorder images and reset
      topImg.addEventListener('animationend', () => {
        reorderImages(direction);
        isAnimating = false;
      }, { once: true });
    }

    // Desktop click handlers
    if (!isMobile) {
      stack.addEventListener('click', (e) => {
        if (isAnimating) return;
        // Determine click position relative to center
        const rect = stack.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const centerX = rect.width / 2;
        if (clickX < centerX) {
          animateSlide('left');
        } else {
          animateSlide('right');
        }
      });
    }

    // Mobile touch handlers for swipe
    if (isMobile) {
      stack.addEventListener('touchstart', (e) => {
        if (isAnimating) return;
        if (e.touches.length === 1) {
          startX = e.touches[0].clientX;
          isTouching = true;
        }
      });

      stack.addEventListener('touchmove', (e) => {
        if (!isTouching) return;
        currentX = e.touches[0].clientX;
        const diffX = currentX - startX;
        // Optional: could add drag effect here if desired
      });

      stack.addEventListener('touchend', (e) => {
        if (!isTouching) return;
        isTouching = false;
        const diffX = currentX - startX;
        if (Math.abs(diffX) > 40) {
          animateSlide(diffX < 0 ? 'left' : 'right');
        }
      });
    }
  })();
  </script>
 </body>
</html>
